# Replace api.example.com with your real DNS name pointing to the server's public IP
api.example.com {
  encode zstd gzip

  # Serve the static web UI from /srv/www (mounted from ./web)
  root * /srv/www
  file_server

  # Proxy API requests to the FastAPI service
  handle_path /api/* {
    reverse_proxy control-api:8080
  }

  # Optional: tighten timeouts (defaults are fine for this API)
  # transport http {
  #   read_timeout  30s
  #   write_timeout 30s
  # }

  # CORS is handled by FastAPI; you can add extra headers here if desired
  # header {
  #   Access-Control-Allow-Origin "https://youruser.github.io"
  #   Access-Control-Allow-Headers "Authorization, Content-Type"
  #   Access-Control-Allow-Methods "GET, POST, OPTIONS"
  # }
}
